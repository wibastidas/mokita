!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"4gjS":function(o,n,r){"use strict";r.r(n),r.d(n,"NewSalePageModule",(function(){return k}));var a=r("ofXK"),i=r("3Pt+"),s=r("TEn/"),c=r("tyNb"),u=r("mrSG"),l=r("wd/R"),m=r("fXoL"),b=r("3LUQ"),d=r("UrgT"),g=r("lGQG"),f=r("ccOi");function p(e,t){if(1&e&&(m.Nb(0,"ion-select-option",16),m.nc(1),m.Mb()),2&e){var o=t.$implicit;m.fc("value",o.id),m.yb(1),m.pc("",o.name+" "+o.lastName," ")}}function v(e,t){if(1&e&&(m.Nb(0,"div"),m.nc(1),m.Mb()),2&e){var o=m.Xb().$implicit;m.yb(1),m.pc(" ",o.message," ")}}function h(e,t){if(1&e&&(m.Lb(0),m.mc(1,v,2,1,"div",17),m.Kb()),2&e){var o=t.$implicit,n=m.Xb();m.yb(1),m.ec("ngIf",n.saleForm.get("amount").hasError(o.type)&&(n.saleForm.get("amount").dirty||n.saleForm.get("amount").touched))}}function y(e,t){if(1&e&&(m.Nb(0,"div"),m.nc(1),m.Mb()),2&e){var o=m.Xb().$implicit;m.yb(1),m.pc(" ",o.message," ")}}function C(e,t){if(1&e&&(m.Lb(0),m.mc(1,y,2,1,"div",17),m.Kb()),2&e){var o=t.$implicit,n=m.Xb();m.yb(1),m.ec("ngIf",n.saleForm.get("porcentaje").hasError(o.type)&&(n.saleForm.get("porcentaje").dirty||n.saleForm.get("porcentaje").touched))}}function M(e,t){if(1&e&&(m.Nb(0,"div"),m.nc(1),m.Mb()),2&e){var o=m.Xb().$implicit;m.yb(1),m.pc(" ",o.message," ")}}function N(e,t){if(1&e&&(m.Lb(0),m.mc(1,M,2,1,"div",17),m.Kb()),2&e){var o=t.$implicit,n=m.Xb();m.yb(1),m.ec("ngIf",n.saleForm.get("numeroCuotas").hasError(o.type)&&(n.saleForm.get("numeroCuotas").dirty||n.saleForm.get("numeroCuotas").touched))}}var F,w,S,I=[{path:"",component:(F=function(){function o(t,n,r,a,s,c,u){e(this,o),this.formBuilder=t,this.alertController=n,this.alertService=r,this.customersService=a,this.authSvc=s,this.salesService=c,this.location=u,this.validation_messages={amount:[{type:"required",message:"El monto es requerido."}],numeroCuotas:[{type:"required",message:"El n\xfamero de cuotas es requerida."}],porcentaje:[{type:"required",message:"El % de inter\xe9s es requerido."}]},this.saleForm=this.formBuilder.group({amount:new i.b("",i.m.compose([i.m.required])),numeroCuotas:new i.b(20,i.m.compose([i.m.required])),porcentaje:new i.b(20,i.m.compose([i.m.required])),montoCuota:new i.b({value:"",disabled:!0},i.m.compose([i.m.required])),vencimiento:new i.b(""),updatedAt:new i.b("")})}var n,r,a;return n=o,(r=[{key:"ngOnInit",value:function(){var e=this;Object.assign({},this.authSvc.getLoggedUser().roles).hasOwnProperty("admin")?this.customersService.getCustomersByAdmin(this.authSvc.getLoggedUser().uid).subscribe((function(t){e.customers=t.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())})),e.customers=e.customers.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}))})):this.customersService.getCustomersByCobrador(this.authSvc.getLoggedUser().uid).subscribe((function(t){e.customers=t.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())}))})),this.saleForm.valueChanges.subscribe((function(t){e.saleForm.get("amount")&&e.saleForm.get("numeroCuotas")&&e.saleForm.get("porcentaje")&&e.calcularMontoCuota()}))}},{key:"registerSale",value:function(e){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o,n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Confirmar!",message:"Registrar <strong>Pr\xe9stamo</strong>",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Cancelar")}},{text:"Ok",handler:function(){n.createSale(e)}}]});case 2:return o=t.sent,t.next=5,o.present();case 5:case"end":return t.stop()}}),t,this)})))}},{key:"createSale",value:function(e){return Object(u.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.createdAt=l().format("ll"),e.updatedAt=l().format("llll"),e.cuotas=this.createCuotas(e.numeroCuotas),e.customerId=this.customerId,e.intereses=e.amount*e.porcentaje/100,e.montoConInteres=e.amount+e.intereses,e.montoCuota=e.montoConInteres/e.numeroCuotas,e.estado="Active",e.vencimiento=e.cuotas[e.numeroCuotas-1].date,e.abonos=[],e.cuotasPendientes=e.numeroCuotas,e.cuotasPagadas=0,e.saldo=e.montoConInteres,e.createdBy=this.authSvc.getLoggedUser().uid,e.adminId=this.authSvc.getLoggedUser().createdBy?this.authSvc.getLoggedUser().createdBy:this.authSvc.getLoggedUser().uid,t.next=17,this.salesService.createNewSale(e).then((function(e){o.showConfirmation()}));case 17:case"end":return t.stop()}}),t,this)})))}},{key:"showConfirmation",value:function(){this.alertService.presentAlert("Pr\xe9stamo creado satisfactoriamente!","Puede ver el prestamo en la informaci\xf3n del cliente",["Ok"]),this.location.back()}},{key:"createCuotas",value:function(e){var t,o=[],n=e;for(t=1;t<=n;t++)"domingo"!==l(l().add(t,"days").format("YYYY-MM-DD")).format("dddd")?o.push({cuota:o.length+1,date:l().add(t,"days").format("ll"),fechaPago:null}):n+=1;return o}},{key:"calcularMontoCuota",value:function(){var e=this.saleForm.get("amount").value*this.saleForm.get("porcentaje").value/100,t=this.saleForm.get("amount").value+e;this.montoCuota=t/this.saleForm.get("numeroCuotas").value}}])&&t(n.prototype,r),a&&t(n,a),o}(),F.\u0275fac=function(e){return new(e||F)(m.Ib(i.a),m.Ib(s.b),m.Ib(b.a),m.Ib(d.a),m.Ib(g.a),m.Ib(f.a),m.Ib(a.i))},F.\u0275cmp=m.Cb({type:F,selectors:[["app-new-sale"]],decls:42,vars:8,consts:[["slot","start"],["okText","Seleccionar","cancelText","Cancelar",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup","ngSubmit"],["type","number","formControlName","amount"],["size","small","name","cash-outline","color","primary","slot","end",1,"ion-align-self-center"],[1,"validation-errors"],[4,"ngFor","ngForOf"],["type","number","formControlName","porcentaje"],["size","small","name","wallet-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","number","formControlName","numeroCuotas"],["size","small","name","sync-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","text","formControlName","montoCuota",3,"value"],["size","small","name","card-outline","color","primary","slot","end",1,"ion-align-self-center"],[1,"ion-text-center"],["expand","round","type","submit",3,"disabled"],[3,"value"],[4,"ngIf"]],template:function(e,t){1&e&&(m.Nb(0,"ion-header"),m.Nb(1,"ion-toolbar"),m.Nb(2,"ion-title"),m.nc(3,"Nuevo Pr\xe9stamo"),m.Mb(),m.Nb(4,"ion-buttons",0),m.Jb(5,"ion-back-button"),m.Mb(),m.Mb(),m.Mb(),m.Nb(6,"ion-content"),m.Nb(7,"ion-item"),m.Nb(8,"ion-label"),m.nc(9,"Seleccionar Cliente"),m.Mb(),m.Nb(10,"ion-select",1),m.Vb("ngModelChange",(function(e){return t.customerId=e})),m.mc(11,p,2,2,"ion-select-option",2),m.Mb(),m.Mb(),m.Nb(12,"form",3),m.Vb("ngSubmit",(function(){return t.registerSale(t.saleForm.value)})),m.Nb(13,"ion-item"),m.Nb(14,"ion-label"),m.nc(15,"Monto: "),m.Mb(),m.Jb(16,"ion-input",4),m.Jb(17,"ion-icon",5),m.Mb(),m.Nb(18,"div",6),m.mc(19,h,2,1,"ng-container",7),m.Mb(),m.Nb(20,"ion-item"),m.Nb(21,"ion-label"),m.nc(22,"% Inter\xe9s: "),m.Mb(),m.Jb(23,"ion-input",8),m.Jb(24,"ion-icon",9),m.Mb(),m.Nb(25,"div",6),m.mc(26,C,2,1,"ng-container",7),m.Mb(),m.Nb(27,"ion-item"),m.Nb(28,"ion-label"),m.nc(29,"N\xfamero de cuotas: "),m.Mb(),m.Jb(30,"ion-input",10),m.Jb(31,"ion-icon",11),m.Mb(),m.Nb(32,"div",6),m.mc(33,N,2,1,"ng-container",7),m.Mb(),m.Nb(34,"ion-item"),m.Nb(35,"ion-label"),m.nc(36,"Monto de la Cuota: "),m.Mb(),m.Jb(37,"ion-input",12),m.Jb(38,"ion-icon",13),m.Mb(),m.Nb(39,"div",14),m.Nb(40,"ion-button",15),m.nc(41,"Registrar Pr\xe9stamo"),m.Mb(),m.Mb(),m.Mb(),m.Mb()),2&e&&(m.yb(10),m.ec("ngModel",t.customerId),m.yb(1),m.ec("ngForOf",t.customers),m.yb(1),m.ec("formGroup",t.saleForm),m.yb(7),m.ec("ngForOf",t.validation_messages.amount),m.yb(7),m.ec("ngForOf",t.validation_messages.porcentaje),m.yb(7),m.ec("ngForOf",t.validation_messages.numeroCuotas),m.yb(4),m.ec("value",t.montoCuota),m.yb(3),m.ec("disabled",t.saleForm.invalid||!t.customerId))},directives:[s.s,s.Q,s.P,s.i,s.e,s.f,s.p,s.v,s.A,s.I,s.X,i.h,i.k,a.k,i.n,i.i,i.d,s.u,s.U,i.c,s.t,s.Y,s.h,s.J,a.l],styles:[""]}),F)}],j=((S=function t(){e(this,t)}).\u0275mod=m.Gb({type:S}),S.\u0275inj=m.Fb({factory:function(e){return new(e||S)},imports:[[c.j.forChild(I)],c.j]}),S),k=((w=function t(){e(this,t)}).\u0275mod=m.Gb({type:w}),w.\u0275inj=m.Fb({factory:function(e){return new(e||w)},imports:[[a.c,i.e,s.R,j,i.l]]}),w)}}])}();