!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{jYoP:function(t,o,i){"use strict";i.r(o),i.d(o,"CustomerDetailPageModule",(function(){return Y}));var r=i("ofXK"),a=i("3Pt+"),s=i("TEn/"),c=i("PCNd"),l=i("tyNb"),m=i("mrSG"),b=i("wd/R"),u=i("IzEk"),d=i("fXoL"),g=i("UrgT"),f=i("lGQG"),p=i("3LUQ"),y=i("6c4d"),h=i("ccOi"),v=i("b1s6");function N(e,n){1&e&&d.Jb(0,"ion-progress-bar",12)}function M(e,n){1&e&&d.Jb(0,"app-skeleton")}function I(e,n){1&e&&(d.Nb(0,"div",15),d.nc(1," El cliente no tiene pr\xe9stamos asociados. "),d.Mb())}function C(e,n){if(1&e&&(d.Lb(0),d.mc(1,I,2,0,"div",14),d.Kb()),2&e){var t=d.Xb(2);d.yb(1),d.ec("ngIf",!t.sales||0==t.sales.length)}}function S(e,n){if(1&e){var t=d.Ob();d.Nb(0,"ion-button",21),d.Vb("click",(function(){d.jc(t);var e=d.Xb().$implicit;return d.Xb(3).goSaleDetail(e)})),d.nc(1,"Ver m\xe1s"),d.Mb()}}function F(e,n){if(1&e){var t=d.Ob();d.Nb(0,"ion-item-options",22),d.Nb(1,"ion-item-option",23),d.Vb("click",(function(){d.jc(t);var e=d.Xb().$implicit;return d.Xb(3).deleteSaleConfirm(e)})),d.Jb(2,"ion-icon",24),d.Mb(),d.Mb()}}function w(e,n){if(1&e&&(d.Nb(0,"ion-item-sliding",17),d.Nb(1,"ion-item"),d.Nb(2,"ion-label"),d.Nb(3,"h2"),d.nc(4),d.Mb(),d.Nb(5,"h3"),d.nc(6),d.Yb(7,"currency"),d.Mb(),d.Nb(8,"p",18),d.nc(9),d.Mb(),d.Mb(),d.mc(10,S,2,0,"ion-button",19),d.Mb(),d.mc(11,F,3,0,"ion-item-options",20),d.Mb()),2&e){var t=n.$implicit,o=d.Xb(3);d.yb(4),d.pc("Estado: ",t.estado,""),d.yb(2),d.pc("Monto: ",d.bc(7,6,t.amount,"$","symbol","1.2-2"),""),d.yb(3),d.qc("Cuotas: ",t.numeroCuotas," x ",t.montoCuota," "),d.yb(1),d.ec("ngIf",o.roleAutorization.canReadSale(o.authSvc.getLoggedUser())),d.yb(1),d.ec("ngIf",o.roleAutorization.canDeleteSale(o.authSvc.getLoggedUser()))}}function O(e,n){if(1&e&&(d.Lb(0),d.mc(1,w,12,11,"ion-item-sliding",16),d.Kb()),2&e){var t=d.Xb(2);d.yb(1),d.ec("ngForOf",t.sales)}}function X(e,n){if(1&e&&(d.Nb(0,"ion-list",13),d.mc(1,C,2,1,"ng-container",3),d.mc(2,O,2,1,"ng-container",3),d.Mb()),2&e){var t=d.Xb();d.yb(1),d.ec("ngIf",!t.loadingLoansInformation),d.yb(1),d.ec("ngIf",t.sales&&t.sales.length>0)}}function k(e,n){if(1&e&&(d.Nb(0,"div",43),d.nc(1),d.Mb()),2&e){var t=d.Xb().$implicit;d.yb(1),d.pc(" ",t.message," ")}}function L(e,n){if(1&e&&(d.Lb(0),d.mc(1,k,2,1,"div",42),d.Kb()),2&e){var t=n.$implicit,o=d.Xb(2);d.yb(1),d.ec("ngIf",o.customerForm.get("name").hasError(t.type)&&(o.customerForm.get("name").dirty||o.customerForm.get("name").touched))}}function q(e,n){if(1&e&&(d.Nb(0,"div",43),d.nc(1),d.Mb()),2&e){var t=d.Xb().$implicit;d.yb(1),d.pc(" ",t.message," ")}}function x(e,n){if(1&e&&(d.Lb(0),d.mc(1,q,2,1,"div",42),d.Kb()),2&e){var t=n.$implicit,o=d.Xb(2);d.yb(1),d.ec("ngIf",o.customerForm.get("lastName").hasError(t.type)&&(o.customerForm.get("lastName").dirty||o.customerForm.get("lastName").touched))}}function E(e,n){if(1&e&&(d.Nb(0,"div",43),d.nc(1),d.Mb()),2&e){var t=d.Xb().$implicit;d.yb(1),d.pc(" ",t.message," ")}}function z(e,n){if(1&e&&(d.Lb(0),d.mc(1,E,2,1,"div",42),d.Kb()),2&e){var t=n.$implicit,o=d.Xb(2);d.yb(1),d.ec("ngIf",o.customerForm.get("document").hasError(t.type)&&(o.customerForm.get("document").dirty||o.customerForm.get("document").touched))}}function J(e,n){if(1&e&&(d.Nb(0,"div",43),d.nc(1),d.Mb()),2&e){var t=d.Xb().$implicit;d.yb(1),d.pc(" ",t.message," ")}}function $(e,n){if(1&e&&(d.Lb(0),d.mc(1,J,2,1,"div",42),d.Kb()),2&e){var t=n.$implicit,o=d.Xb(2);d.yb(1),d.ec("ngIf",o.customerForm.get("phoneNumber").hasError(t.type)&&(o.customerForm.get("phoneNumber").dirty||o.customerForm.get("phoneNumber").touched))}}function A(e,n){if(1&e&&(d.Nb(0,"div",43),d.nc(1),d.Mb()),2&e){var t=d.Xb().$implicit;d.yb(1),d.pc(" ",t.message," ")}}function j(e,n){if(1&e&&(d.Lb(0),d.mc(1,A,2,1,"div",42),d.Kb()),2&e){var t=n.$implicit,o=d.Xb(2);d.yb(1),d.ec("ngIf",o.customerForm.get("address").hasError(t.type)&&(o.customerForm.get("address").dirty||o.customerForm.get("address").touched))}}function P(e,n){if(1&e&&(d.Nb(0,"div",43),d.nc(1),d.Mb()),2&e){var t=d.Xb().$implicit;d.yb(1),d.pc(" ",t.message," ")}}function B(e,n){if(1&e&&(d.Lb(0),d.mc(1,P,2,1,"div",42),d.Kb()),2&e){var t=n.$implicit,o=d.Xb(2);d.yb(1),d.ec("ngIf",o.customerForm.get("reference").hasError(t.type)&&(o.customerForm.get("reference").dirty||o.customerForm.get("reference").touched))}}function D(e,n){if(1&e&&(d.Nb(0,"ion-select-option",46),d.nc(1),d.Mb()),2&e){var t=n.$implicit;d.fc("value",t.uid),d.yb(1),d.pc("",t.displayName||t.email," ")}}function U(e,n){if(1&e&&(d.Nb(0,"ion-item"),d.Nb(1,"ion-label"),d.nc(2,"Seleccionar Cobrador"),d.Mb(),d.Nb(3,"ion-select",44),d.mc(4,D,2,2,"ion-select-option",45),d.Mb(),d.Mb()),2&e){var t=d.Xb(2);d.yb(4),d.ec("ngForOf",t.cobradores)}}function _(e,n){if(1&e&&(d.Nb(0,"div",15),d.Nb(1,"ion-button",47),d.nc(2,"Actualizar"),d.Mb(),d.Mb()),2&e){var t=d.Xb(2);d.yb(1),d.ec("disabled",t.customerForm.invalid)}}function K(e,n){if(1&e){var t=d.Ob();d.Nb(0,"ion-list"),d.Nb(1,"form",25),d.Vb("ngSubmit",(function(){return d.jc(t),d.Xb().updateCustomer()})),d.Nb(2,"ion-list-header",26),d.nc(3," Informaci\xf3n Personal "),d.Mb(),d.Nb(4,"ion-item"),d.Nb(5,"ion-label",27),d.nc(6,"Nombre: "),d.Mb(),d.Jb(7,"ion-input",28),d.Jb(8,"ion-icon",29),d.Mb(),d.Nb(9,"div",30),d.mc(10,L,2,1,"ng-container",31),d.Mb(),d.Nb(11,"ion-item"),d.Nb(12,"ion-label",27),d.nc(13,"Apellido: "),d.Mb(),d.Jb(14,"ion-input",32),d.Jb(15,"ion-icon",33),d.Mb(),d.Nb(16,"div",30),d.mc(17,x,2,1,"ng-container",31),d.Mb(),d.Nb(18,"ion-item"),d.Nb(19,"ion-label",27),d.nc(20,"C\xe9dula: "),d.Mb(),d.Jb(21,"ion-input",34),d.Jb(22,"ion-icon",35),d.Mb(),d.Nb(23,"div",30),d.mc(24,z,2,1,"ng-container",31),d.Mb(),d.Nb(25,"ion-list-header",26),d.nc(26," Datos de Contacto "),d.Mb(),d.Nb(27,"ion-item"),d.Nb(28,"ion-label",27),d.nc(29,"Celular: "),d.Mb(),d.Jb(30,"ion-input",36),d.Jb(31,"ion-icon",37),d.Mb(),d.Nb(32,"div",30),d.mc(33,$,2,1,"ng-container",31),d.Mb(),d.Nb(34,"ion-item"),d.Nb(35,"ion-label",27),d.nc(36,"Direcci\xf3n: "),d.Mb(),d.Jb(37,"ion-input",38),d.Jb(38,"ion-icon",39),d.Mb(),d.Nb(39,"div",30),d.mc(40,j,2,1,"ng-container",31),d.Mb(),d.Nb(41,"ion-item"),d.Nb(42,"ion-label",27),d.nc(43,"Referencia: "),d.Mb(),d.Jb(44,"ion-input",40),d.Jb(45,"ion-icon",41),d.Mb(),d.Nb(46,"div",30),d.mc(47,B,2,1,"ng-container",31),d.Mb(),d.mc(48,U,5,1,"ion-item",3),d.mc(49,_,3,1,"div",14),d.Mb(),d.Mb()}if(2&e){var o=d.Xb();d.yb(1),d.ec("formGroup",o.customerForm),d.yb(9),d.ec("ngForOf",o.validation_messages.name),d.yb(7),d.ec("ngForOf",o.validation_messages.lastName),d.yb(7),d.ec("ngForOf",o.validation_messages.document),d.yb(9),d.ec("ngForOf",o.validation_messages.phoneNumber),d.yb(7),d.ec("ngForOf",o.validation_messages.address),d.yb(7),d.ec("ngForOf",o.validation_messages.reference),d.yb(1),d.ec("ngIf",o.roleAutorization.canEditCustomerVendor(o.authSvc.getLoggedUser())),d.yb(1),d.ec("ngIf",o.roleAutorization.canEditCustomer(o.authSvc.getLoggedUser()))}}var G,R,V,T=[{path:"",component:(G=function(){function t(n,o,i,r,s,c,l,m,u,d){e(this,t),this.modalCtrl=n,this.customersService=o,this.formBuilder=i,this.route=r,this.alertController=s,this.router=c,this.authSvc=l,this.alertService=m,this.roleAutorization=u,this.salesService=d,this.isAdmin=!1,this.loadingCustomerInformation=!1,this.loadingLoansInformation=!1,this.validation_messages={name:[{type:"required",message:"El nombre es requerido."}],lastName:[{type:"required",message:"El apellido es requerido."}],document:[{type:"required",message:"La c\xe9dula es requerida."}],phoneNumber:[{type:"required",message:"El celular es requerido."}],address:[{type:"required",message:"La direcci\xf3n es requerida."}],email:[{type:"required",message:"El correo es requerido."},{type:"pattern",message:"Este no es un email v\xe1lido."}],reference:[{type:"required",message:"La referencia es requerida."}]},this.customerId=this.route.snapshot.paramMap.get("id"),console.log("customerId: ",this.customerId),this.type="loansInformation",this.customerForm=this.formBuilder.group({name:new a.b("",a.m.compose([a.m.required])),lastName:new a.b("",a.m.compose([a.m.required])),document:new a.b({value:"",disabled:!0},a.m.compose([a.m.required])),phoneNumber:new a.b("",a.m.compose([a.m.required])),address:new a.b("",a.m.compose([a.m.required])),email:new a.b("",a.m.compose([a.m.email,a.m.pattern("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$")])),reference:new a.b("",a.m.compose([])),createdAt:new a.b(b().format("ll")),createdBy:"",adminId:"",cobradorId:"",id:new a.b("")})}var o,i,r;return o=t,(i=[{key:"ngOnInit",value:function(){var e=this;this.isAdmin=Object.assign({},this.authSvc.getLoggedUser().roles).hasOwnProperty("admin"),this.isAdmin&&this.customersService.getVendedoresByAdmin(this.authSvc.getLoggedUser().uid).subscribe((function(n){e.cobradores=n.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())})),console.log("this.cobradores: ",e.cobradores)})),this.loadingCustomerInformation=!0,this.customersService.getCustomerById(this.customerId).subscribe((function(n){e.loadingCustomerInformation=!1,n.id=e.customerId,e.customer=n,e.customerForm.setValue(n),e.getSalesByCustomerId()}))}},{key:"getSalesByCustomerId",value:function(){var e=this;this.loadingLoansInformation=!0,this.salesService.getSalesByCustomerId(this.customer.id).pipe(Object(u.a)(1)).subscribe((function(n){return Object(m.a)(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loadingLoansInformation=!1,this.sales=n.map((function(e){return Object.assign({id:e.payload.doc.id},e.payload.doc.data())})),console.log("this.sales: ",this.sales);case 1:case"end":return e.stop()}}),e,this)})))}))}},{key:"ngOnDestroy",value:function(){}},{key:"updateCustomer",value:function(){this.customersService.updateCustomer(this.customerForm.value).then((function(e){return e})),this.alertService.presentToast("Cliente Actualizado!.",2e3,"top","primary")}},{key:"segmentChanged",value:function(e){console.log("segmentChanged ev:  ",e.detail.value)}},{key:"deleteSale",value:function(e){var n=this;console.log("deleteSale: ",e),this.salesService.deleteSale(e.id).then((function(e){return n.getSalesByCustomerId()}))}},{key:"goSaleDetail",value:function(e){this.router.navigateByUrl("/sale-detail/"+e.id)}},{key:"deleteSaleConfirm",value:function(e){return Object(m.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,o=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Eliminar!",message:"Eliminar <strong>pr\xe9stamo</strong>",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Cancelar")}},{text:"Ok",handler:function(){o.deleteSale(e)}}]});case 2:return t=n.sent,n.next=5,t.present();case 5:case"end":return n.stop()}}),n,this)})))}}])&&n(o.prototype,i),r&&n(o,r),t}(),G.\u0275fac=function(e){return new(e||G)(d.Ib(s.T),d.Ib(g.a),d.Ib(a.a),d.Ib(l.a),d.Ib(s.b),d.Ib(l.g),d.Ib(f.a),d.Ib(p.a),d.Ib(y.a),d.Ib(h.a))},G.\u0275cmp=d.Cb({type:G,selectors:[["app-customer-detail"]],decls:22,vars:8,consts:[["slot","start"],["fullscreen","",1,"customer-detail-page"],["type","indeterminate",4,"ngIf"],[4,"ngIf"],[3,"translucent"],[3,"ngModel","ionChange","ngModelChange"],["value","loansInformation"],["value","customerInformation"],[3,"fullscreen"],[3,"ngSwitch"],["class","ion-padding","color","light",4,"ngSwitchCase"],[4,"ngSwitchCase"],["type","indeterminate"],["color","light",1,"ion-padding"],["class","ion-text-center",4,"ngIf"],[1,"ion-text-center"],["class","loan-item",4,"ngFor","ngForOf"],[1,"loan-item"],[1,"ion-text-capitalize"],["fill","outline","slot","end",3,"click",4,"ngIf"],["side","end",4,"ngIf"],["fill","outline","slot","end",3,"click"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"],[1,"new-customer-page",3,"formGroup","ngSubmit"],[1,"ios","hydrated"],["position","floating","color","primary"],["type","text","formControlName","name"],["size","small","name","person-outline","color","primary","slot","end",1,"ion-align-self-center"],[1,"validation-errors"],[4,"ngFor","ngForOf"],["type","text","formControlName","lastName"],["size","small","name","person-circle-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","number","formControlName","document"],["size","small","name","wallet-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","tel","formControlName","phoneNumber"],["size","small","name","phone-portrait-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","text","formControlName","address"],["size","small","name","map-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","text","formControlName","reference"],["size","small","name","reader-outline","color","primary","slot","end",1,"ion-align-self-center"],["class","error-message ion-padding-start",4,"ngIf"],[1,"error-message","ion-padding-start"],["okText","Seleccionar","cancelText","Cancelar","formControlName","cobradorId"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["fill","outline","expand","round","type","submit",3,"disabled"]],template:function(e,n){1&e&&(d.Nb(0,"ion-header"),d.Nb(1,"ion-toolbar"),d.Nb(2,"ion-title"),d.nc(3,"Detalle del Cliente"),d.Mb(),d.Nb(4,"ion-buttons",0),d.Jb(5,"ion-back-button"),d.Mb(),d.Mb(),d.Mb(),d.Nb(6,"ion-content",1),d.mc(7,N,1,0,"ion-progress-bar",2),d.mc(8,M,1,0,"app-skeleton",3),d.Nb(9,"ion-header",4),d.Nb(10,"ion-toolbar"),d.Nb(11,"ion-segment",5),d.Vb("ionChange",(function(e){return n.segmentChanged(e)}))("ngModelChange",(function(e){return n.type=e})),d.Nb(12,"ion-segment-button",6),d.Nb(13,"ion-label"),d.nc(14,"Pr\xe9stamos"),d.Mb(),d.Mb(),d.Nb(15,"ion-segment-button",7),d.Nb(16,"ion-label"),d.nc(17,"Datos Personales"),d.Mb(),d.Mb(),d.Mb(),d.Mb(),d.Mb(),d.Nb(18,"ion-content",8),d.Nb(19,"div",9),d.mc(20,X,3,2,"ion-list",10),d.mc(21,K,50,9,"ion-list",11),d.Mb(),d.Mb(),d.Mb()),2&e&&(d.yb(7),d.ec("ngIf",n.loadingLoansInformation),d.yb(1),d.ec("ngIf",n.loadingLoansInformation),d.yb(1),d.ec("translucent",!0),d.yb(2),d.ec("ngModel",n.type),d.yb(7),d.ec("fullscreen",!0),d.yb(1),d.ec("ngSwitch",n.type),d.yb(1),d.ec("ngSwitchCase","loansInformation"),d.yb(1),d.ec("ngSwitchCase","customerInformation"))},directives:[s.s,s.Q,s.P,s.i,s.e,s.f,s.p,r.l,s.G,s.X,a.h,a.k,s.H,s.A,r.n,r.o,s.D,v.a,s.B,r.k,s.z,s.v,s.h,s.y,s.x,s.t,a.n,a.i,a.d,s.C,s.u,s.Y,a.c,s.U,s.I,s.J],pipes:[r.d],styles:[".customer-detail-page[_ngcontent-%COMP%]   .loan-item[_ngcontent-%COMP%]{border-left:solid;margin-top:15px;margin-bottom:15px}"]}),G)}],Q=((V=function n(){e(this,n)}).\u0275mod=d.Gb({type:V}),V.\u0275inj=d.Fb({factory:function(e){return new(e||V)},imports:[[l.j.forChild(T)],l.j]}),V),Y=((R=function n(){e(this,n)}).\u0275mod=d.Gb({type:R}),R.\u0275inj=d.Fb({factory:function(e){return new(e||R)},imports:[[r.c,a.e,s.R,Q,a.l,c.a]]}),R)}}])}();