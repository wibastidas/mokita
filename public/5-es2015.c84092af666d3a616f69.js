(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"0eej":function(e,t,o){"use strict";o.r(t),o.d(t,"RoutePageModule",(function(){return U}));var n=o("ofXK"),s=o("3Pt+"),i=o("TEn/"),a=o("PCNd"),c=o("tyNb"),r=o("mrSG"),l=o("wd/R"),b=o("fXoL"),d=o("lGQG"),u=o("UrgT"),g=o("6c4d"),h=o("b1s6");function m(e,t){1&e&&b.Jb(0,"ion-progress-bar",6)}function f(e,t){1&e&&b.Jb(0,"app-skeleton")}function p(e,t){1&e&&b.Jb(0,"ion-icon",14)}function y(e,t){1&e&&b.Jb(0,"ion-icon",15)}function v(e,t){1&e&&b.Jb(0,"ion-icon",16)}function S(e,t){if(1&e){const e=b.Ob();b.Nb(0,"div"),b.Nb(1,"ion-item",8),b.Vb("click",(function(){b.jc(e);const t=b.Xb().$implicit;return b.Xb(2).goSaleDetail(t.sale[0])})),b.Nb(2,"ion-avatar"),b.mc(3,p,1,0,"ion-icon",9),b.mc(4,y,1,0,"ion-icon",10),b.mc(5,v,1,0,"ion-icon",11),b.Mb(),b.Nb(6,"ion-label",12),b.Nb(7,"ion-text"),b.Nb(8,"h3"),b.nc(9),b.Mb(),b.Mb(),b.Nb(10,"h3"),b.nc(11),b.Yb(12,"currency"),b.Mb(),b.Nb(13,"h3"),b.nc(14),b.Yb(15,"number"),b.Mb(),b.Mb(),b.Jb(16,"ion-icon",13),b.Mb(),b.Mb()}if(2&e){const e=b.Xb().$implicit,t=b.Xb(2);b.yb(3),b.ec("ngIf",e.sale[0].abonos[e.sale[0].abonos.length-1]&&e.sale[0].abonos[e.sale[0].abonos.length-1].createdAt!=t.today||!e.sale[0].abonos[0]),b.yb(1),b.ec("ngIf",e.sale[0].abonos[e.sale[0].abonos.length-1]&&e.sale[0].abonos[e.sale[0].abonos.length-1].createdAt==t.today&&e.sale[0].abonos[e.sale[0].abonos.length-1].monto>0),b.yb(1),b.ec("ngIf",e.sale[0].abonos[e.sale[0].abonos.length-1]&&e.sale[0].abonos[e.sale[0].abonos.length-1].createdAt==t.today&&0==e.sale[0].abonos[e.sale[0].abonos.length-1].monto),b.yb(4),b.qc("",e.name," ",e.lastName,""),b.yb(2),b.pc("Saldo Pendiente: ",b.ac(12,7,e.sale[0].saldo,"$"),""),b.yb(3),b.pc("Cuotas Pendientes: ",b.Zb(15,10,e.sale[0].cuotasPendientes),"")}}function N(e,t){if(1&e&&(b.Nb(0,"ion-item-sliding"),b.mc(1,S,17,12,"div",4),b.Mb()),2&e){const e=t.$implicit;b.yb(1),b.ec("ngIf",e&&e.sale&&e.sale[0])}}function C(e,t){if(1&e&&(b.Nb(0,"ion-list"),b.mc(1,N,2,1,"ion-item-sliding",7),b.Mb()),2&e){const e=b.Xb();b.yb(1),b.ec("ngForOf",e.customers)}}function I(e,t){if(1&e&&(b.Nb(0,"ion-item-divider"),b.Nb(1,"ion-label"),b.nc(2),b.Mb(),b.Mb()),2&e){const e=b.Xb();b.yb(2),b.pc(" Total Recaudado: ",e.totalRecaudado," ")}}function M(e,t){if(1&e){const e=b.Ob();b.Nb(0,"ion-fab",17),b.Vb("click",(function(){return b.jc(e),b.Xb().goNewSale()})),b.Nb(1,"ion-fab-button"),b.Jb(2,"ion-icon",18),b.Mb(),b.Mb()}}const w=[{path:"",component:(()=>{class e{constructor(e,t,o,n,s){this.router=e,this.actionSheetController=t,this.authSvc=o,this.customersService=n,this.roleAutorization=s,this.loading=!1,this.today=l().format("ll"),this.totalRecaudado=0}ngOnInit(){this.authSvc.getLoggedUser()?this.getCustomers():this.authSvc.getLoggedUser$().subscribe(e=>{this.getCustomers()})}goNewSale(){this.router.navigateByUrl("/new-sale")}showOptions(){return Object(r.a)(this,void 0,void 0,(function*(){let e=[{text:"Cerrar Sesi\xf3n",icon:"log-out-outline",handler:()=>{this.authSvc.logout(),this.router.navigate(["/login"])}},{text:"Cancelar",icon:"close",role:"cancel",handler:()=>{console.log("Cancelar clicked")}}];this.roleAutorization.canCreateUser(this.authSvc.getLoggedUser())&&e.unshift({text:"Crear Usuario",icon:"person-add-outline",handler:()=>{this.router.navigate(["/register"])}});const t=yield this.actionSheetController.create({header:this.authSvc.getLoggedUser().displayName||this.authSvc.getLoggedUser().email,cssClass:"my-custom-class",buttons:e});yield t.present()}))}getCustomers(){this.loading=!0,Object.assign({},this.authSvc.getLoggedUser().roles).hasOwnProperty("admin")?this.customersService.getCustomersByAdmin(this.authSvc.getLoggedUser().uid).subscribe(e=>{this.customers=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())),this.customers=this.customers.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),this.getSalesByCustomer(),this.loading=!1}):this.customersService.getCustomersByCobrador(this.authSvc.getLoggedUser().uid).subscribe(e=>{this.customers=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())),this.getSalesByCustomer(),this.customers=this.customers.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})),this.loading=!1})}getSalesByCustomer(){if(this.customers&&this.customers.length>0){let e=0;this.customers.forEach(t=>{this.customersService.getSalesByCustomerId(t.id).subscribe(o=>{let n=o.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data()));t.sale=n,e++,e==this.customers.length&&this.calcularRecaudo(this.customers)})}),this.loading=!1}}goSaleDetail(e){this.router.navigateByUrl("/sale-detail/"+e.id)}calcularRecaudo(e){this.customers.forEach(e=>{e.sale&&e.sale[0]&&e.sale[0].abonos&&e.sale[0].abonos[0]&&e.sale[0].abonos[e.sale[0].abonos.length-1]&&e.sale[0].abonos[e.sale[0].abonos.length-1].createdAt==this.today&&(this.totalRecaudado+=e.sale[0].abonos[e.sale[0].abonos.length-1].monto)})}}return e.\u0275fac=function(t){return new(t||e)(b.Ib(c.g),b.Ib(i.a),b.Ib(d.a),b.Ib(u.a),b.Ib(g.a))},e.\u0275cmp=b.Cb({type:e,selectors:[["app-route"]],decls:13,vars:5,consts:[["slot","primary"],["fill","clear",3,"click"],["slot","end","name","settings-outline"],["type","indeterminate",4,"ngIf"],[4,"ngIf"],["style","padding-bottom: 40px;padding-right: 10px;","vertical","bottom","horizontal","end","edge","","slot","fixed",3,"click",4,"ngIf"],["type","indeterminate"],[4,"ngFor","ngForOf"],[3,"click"],["name","shield-outline",4,"ngIf"],["color","success","name","shield-checkmark-outline",4,"ngIf"],["color","warning","name","shield-outline",4,"ngIf"],[2,"margin-left","12px"],["slot","end","name","chevron-forward-outline"],["name","shield-outline"],["color","success","name","shield-checkmark-outline"],["color","warning","name","shield-outline"],["vertical","bottom","horizontal","end","edge","","slot","fixed",2,"padding-bottom","40px","padding-right","10px",3,"click"],["name","add"]],template:function(e,t){1&e&&(b.Nb(0,"ion-header"),b.Nb(1,"ion-toolbar"),b.Nb(2,"ion-title"),b.nc(3,"Mi Ruta"),b.Mb(),b.Nb(4,"ion-buttons",0),b.Nb(5,"ion-button",1),b.Vb("click",(function(){return t.showOptions()})),b.Jb(6,"ion-icon",2),b.Mb(),b.Mb(),b.Mb(),b.Mb(),b.Nb(7,"ion-content"),b.mc(8,m,1,0,"ion-progress-bar",3),b.mc(9,f,1,0,"app-skeleton",4),b.mc(10,C,2,1,"ion-list",4),b.mc(11,I,3,1,"ion-item-divider",4),b.mc(12,M,3,0,"ion-fab",5),b.Mb()),2&e&&(b.yb(8),b.ec("ngIf",t.loading),b.yb(1),b.ec("ngIf",t.loading),b.yb(1),b.ec("ngIf",!t.loading&&t.roleAutorization.canReadCustomer(t.authSvc.getLoggedUser())),b.yb(1),b.ec("ngIf",t.customers&&t.customers.length>0),b.yb(1),b.ec("ngIf",t.roleAutorization.canCreateSale(t.authSvc.getLoggedUser())))},directives:[i.s,i.Q,i.P,i.i,i.h,i.t,i.p,n.l,i.D,h.a,i.B,n.k,i.z,i.v,i.d,i.A,i.O,i.w,i.q,i.r],pipes:[n.d,n.f],styles:[""]}),e})()}];let k=(()=>{class e{}return e.\u0275mod=b.Gb({type:e}),e.\u0275inj=b.Fb({factory:function(t){return new(t||e)},imports:[[c.j.forChild(w)],c.j]}),e})(),U=(()=>{class e{}return e.\u0275mod=b.Gb({type:e}),e.\u0275inj=b.Fb({factory:function(t){return new(t||e)},imports:[[n.c,s.e,i.R,a.a,k]]}),e})()}}]);