(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"4gjS":function(e,t,o){"use strict";o.r(t),o.d(t,"NewSalePageModule",(function(){return F}));var n=o("ofXK"),a=o("3Pt+"),s=o("TEn/"),r=o("tyNb"),i=o("mrSG"),c=o("wd/R"),l=o("fXoL"),m=o("3LUQ"),u=o("UrgT"),b=o("lGQG"),d=o("ccOi");function g(e,t){if(1&e&&(l.Nb(0,"ion-select-option",16),l.nc(1),l.Mb()),2&e){const e=t.$implicit;l.fc("value",e.id),l.yb(1),l.pc("",e.name+" "+e.lastName," ")}}function p(e,t){if(1&e&&(l.Nb(0,"div"),l.nc(1),l.Mb()),2&e){const e=l.Xb().$implicit;l.yb(1),l.pc(" ",e.message," ")}}function h(e,t){if(1&e&&(l.Lb(0),l.mc(1,p,2,1,"div",17),l.Kb()),2&e){const e=t.$implicit,o=l.Xb();l.yb(1),l.ec("ngIf",o.saleForm.get("amount").hasError(e.type)&&(o.saleForm.get("amount").dirty||o.saleForm.get("amount").touched))}}function f(e,t){if(1&e&&(l.Nb(0,"div"),l.nc(1),l.Mb()),2&e){const e=l.Xb().$implicit;l.yb(1),l.pc(" ",e.message," ")}}function y(e,t){if(1&e&&(l.Lb(0),l.mc(1,f,2,1,"div",17),l.Kb()),2&e){const e=t.$implicit,o=l.Xb();l.yb(1),l.ec("ngIf",o.saleForm.get("porcentaje").hasError(e.type)&&(o.saleForm.get("porcentaje").dirty||o.saleForm.get("porcentaje").touched))}}function v(e,t){if(1&e&&(l.Nb(0,"div"),l.nc(1),l.Mb()),2&e){const e=l.Xb().$implicit;l.yb(1),l.pc(" ",e.message," ")}}function C(e,t){if(1&e&&(l.Lb(0),l.mc(1,v,2,1,"div",17),l.Kb()),2&e){const e=t.$implicit,o=l.Xb();l.yb(1),l.ec("ngIf",o.saleForm.get("numeroCuotas").hasError(e.type)&&(o.saleForm.get("numeroCuotas").dirty||o.saleForm.get("numeroCuotas").touched))}}const M=[{path:"",component:(()=>{class e{constructor(e,t,o,n,s,r,i){this.formBuilder=e,this.alertController=t,this.alertService=o,this.customersService=n,this.authSvc=s,this.salesService=r,this.location=i,this.validation_messages={amount:[{type:"required",message:"El monto es requerido."}],numeroCuotas:[{type:"required",message:"El n\xfamero de cuotas es requerida."}],porcentaje:[{type:"required",message:"El % de inter\xe9s es requerido."}]},this.saleForm=this.formBuilder.group({amount:new a.b("",a.m.compose([a.m.required])),numeroCuotas:new a.b(20,a.m.compose([a.m.required])),porcentaje:new a.b(20,a.m.compose([a.m.required])),montoCuota:new a.b({value:"",disabled:!0},a.m.compose([a.m.required])),vencimiento:new a.b(""),updatedAt:new a.b("")})}ngOnInit(){Object.assign({},this.authSvc.getLoggedUser().roles).hasOwnProperty("admin")?this.customersService.getCustomersByAdmin(this.authSvc.getLoggedUser().uid).subscribe(e=>{this.customers=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data())),this.customers=this.customers.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}))}):this.customersService.getCustomersByCobrador(this.authSvc.getLoggedUser().uid).subscribe(e=>{this.customers=e.map(e=>Object.assign({id:e.payload.doc.id},e.payload.doc.data()))}),this.saleForm.valueChanges.subscribe(e=>{this.saleForm.get("amount")&&this.saleForm.get("numeroCuotas")&&this.saleForm.get("porcentaje")&&this.calcularMontoCuota()})}registerSale(e){return Object(i.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Confirmar!",message:"Registrar <strong>Pr\xe9stamo</strong>",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:e=>{console.log("Cancelar")}},{text:"Ok",handler:()=>{this.createSale(e)}}]});yield t.present()}))}createSale(e){return Object(i.a)(this,void 0,void 0,(function*(){e.createdAt=c().format("ll"),e.updatedAt=c().format("llll"),e.cuotas=this.createCuotas(e.numeroCuotas),e.customerId=this.customerId,e.intereses=e.amount*e.porcentaje/100,e.montoConInteres=e.amount+e.intereses,e.montoCuota=e.montoConInteres/e.numeroCuotas,e.estado="Active",e.vencimiento=e.cuotas[e.numeroCuotas-1].date,e.abonos=[],e.cuotasPendientes=e.numeroCuotas,e.cuotasPagadas=0,e.saldo=e.montoConInteres,e.createdBy=this.authSvc.getLoggedUser().uid,e.adminId=this.authSvc.getLoggedUser().createdBy?this.authSvc.getLoggedUser().createdBy:this.authSvc.getLoggedUser().uid,yield this.salesService.createNewSale(e).then(e=>{this.showConfirmation()})}))}showConfirmation(){this.alertService.presentAlert("Pr\xe9stamo creado satisfactoriamente!","Puede ver el prestamo en la informaci\xf3n del cliente",["Ok"]),this.location.back()}createCuotas(e){let t,o=[],n=e;for(t=1;t<=n;t++)"domingo"!==c(c().add(t,"days").format("YYYY-MM-DD")).format("dddd")?o.push({cuota:o.length+1,date:c().add(t,"days").format("ll"),fechaPago:null}):n+=1;return o}calcularMontoCuota(){let e=this.saleForm.get("amount").value*this.saleForm.get("porcentaje").value/100,t=this.saleForm.get("amount").value+e;this.montoCuota=t/this.saleForm.get("numeroCuotas").value}}return e.\u0275fac=function(t){return new(t||e)(l.Ib(a.a),l.Ib(s.b),l.Ib(m.a),l.Ib(u.a),l.Ib(b.a),l.Ib(d.a),l.Ib(n.i))},e.\u0275cmp=l.Cb({type:e,selectors:[["app-new-sale"]],decls:42,vars:8,consts:[["slot","start"],["okText","Seleccionar","cancelText","Cancelar",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"formGroup","ngSubmit"],["type","number","formControlName","amount"],["size","small","name","cash-outline","color","primary","slot","end",1,"ion-align-self-center"],[1,"validation-errors"],[4,"ngFor","ngForOf"],["type","number","formControlName","porcentaje"],["size","small","name","wallet-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","number","formControlName","numeroCuotas"],["size","small","name","sync-outline","color","primary","slot","end",1,"ion-align-self-center"],["type","text","formControlName","montoCuota",3,"value"],["size","small","name","card-outline","color","primary","slot","end",1,"ion-align-self-center"],[1,"ion-text-center"],["expand","round","type","submit",3,"disabled"],[3,"value"],[4,"ngIf"]],template:function(e,t){1&e&&(l.Nb(0,"ion-header"),l.Nb(1,"ion-toolbar"),l.Nb(2,"ion-title"),l.nc(3,"Nuevo Pr\xe9stamo"),l.Mb(),l.Nb(4,"ion-buttons",0),l.Jb(5,"ion-back-button"),l.Mb(),l.Mb(),l.Mb(),l.Nb(6,"ion-content"),l.Nb(7,"ion-item"),l.Nb(8,"ion-label"),l.nc(9,"Seleccionar Cliente"),l.Mb(),l.Nb(10,"ion-select",1),l.Vb("ngModelChange",(function(e){return t.customerId=e})),l.mc(11,g,2,2,"ion-select-option",2),l.Mb(),l.Mb(),l.Nb(12,"form",3),l.Vb("ngSubmit",(function(){return t.registerSale(t.saleForm.value)})),l.Nb(13,"ion-item"),l.Nb(14,"ion-label"),l.nc(15,"Monto: "),l.Mb(),l.Jb(16,"ion-input",4),l.Jb(17,"ion-icon",5),l.Mb(),l.Nb(18,"div",6),l.mc(19,h,2,1,"ng-container",7),l.Mb(),l.Nb(20,"ion-item"),l.Nb(21,"ion-label"),l.nc(22,"% Inter\xe9s: "),l.Mb(),l.Jb(23,"ion-input",8),l.Jb(24,"ion-icon",9),l.Mb(),l.Nb(25,"div",6),l.mc(26,y,2,1,"ng-container",7),l.Mb(),l.Nb(27,"ion-item"),l.Nb(28,"ion-label"),l.nc(29,"N\xfamero de cuotas: "),l.Mb(),l.Jb(30,"ion-input",10),l.Jb(31,"ion-icon",11),l.Mb(),l.Nb(32,"div",6),l.mc(33,C,2,1,"ng-container",7),l.Mb(),l.Nb(34,"ion-item"),l.Nb(35,"ion-label"),l.nc(36,"Monto de la Cuota: "),l.Mb(),l.Jb(37,"ion-input",12),l.Jb(38,"ion-icon",13),l.Mb(),l.Nb(39,"div",14),l.Nb(40,"ion-button",15),l.nc(41,"Registrar Pr\xe9stamo"),l.Mb(),l.Mb(),l.Mb(),l.Mb()),2&e&&(l.yb(10),l.ec("ngModel",t.customerId),l.yb(1),l.ec("ngForOf",t.customers),l.yb(1),l.ec("formGroup",t.saleForm),l.yb(7),l.ec("ngForOf",t.validation_messages.amount),l.yb(7),l.ec("ngForOf",t.validation_messages.porcentaje),l.yb(7),l.ec("ngForOf",t.validation_messages.numeroCuotas),l.yb(4),l.ec("value",t.montoCuota),l.yb(3),l.ec("disabled",t.saleForm.invalid||!t.customerId))},directives:[s.s,s.Q,s.P,s.i,s.e,s.f,s.p,s.v,s.A,s.I,s.X,a.h,a.k,n.k,a.n,a.i,a.d,s.u,s.U,a.c,s.t,s.Y,s.h,s.J,n.l],styles:[""]}),e})()}];let N=(()=>{class e{}return e.\u0275mod=l.Gb({type:e}),e.\u0275inj=l.Fb({factory:function(t){return new(t||e)},imports:[[r.j.forChild(M)],r.j]}),e})(),F=(()=>{class e{}return e.\u0275mod=l.Gb({type:e}),e.\u0275inj=l.Fb({factory:function(t){return new(t||e)},imports:[[n.c,a.e,s.R,N,a.l]]}),e})()}}]);