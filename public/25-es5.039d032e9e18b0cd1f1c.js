!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{HAXa:function(t,o,a){"use strict";a.r(o),a.d(o,"SaleDetailPageModule",(function(){return z}));var r=a("ofXK"),i=a("3Pt+"),c=a("TEn/"),s=a("PCNd"),l=a("tyNb"),b=a("mrSG"),u=a("wd/R"),d=a("ARc2"),f=a("fXoL"),m=a("3LUQ"),p=a("ccOi"),h=a("lGQG"),g=a("6c4d"),y=a("b1s6");function v(e,n){if(1&e){var t=f.Ob();f.Nb(0,"ion-buttons",7),f.Nb(1,"ion-button",8),f.Vb("click",(function(){f.jc(t);var e=f.Xb();return e.editSaleDetail(e.sale)})),f.nc(2," Editar "),f.Mb(),f.Mb()}}function M(e,n){1&e&&f.Jb(0,"ion-progress-bar",9)}function N(e,n){1&e&&f.Jb(0,"app-skeleton")}function C(e,n){if(1&e&&(f.Nb(0,"ion-card"),f.Nb(1,"ion-card-header"),f.Nb(2,"ion-card-subtitle"),f.Nb(3,"ion-badge",10),f.nc(4),f.Mb(),f.Mb(),f.Nb(5,"ion-card-title"),f.nc(6),f.Yb(7,"currency"),f.Mb(),f.Mb(),f.Nb(8,"ion-card-content"),f.Nb(9,"ion-label"),f.Nb(10,"h3"),f.nc(11),f.Yb(12,"currency"),f.Mb(),f.Nb(13,"h3"),f.nc(14),f.Yb(15,"number"),f.Mb(),f.Nb(16,"h3"),f.nc(17),f.Yb(18,"number"),f.Mb(),f.Nb(19,"h3"),f.nc(20),f.Yb(21,"currency"),f.Mb(),f.Nb(22,"h3"),f.nc(23),f.Mb(),f.Nb(24,"h3"),f.nc(25),f.Mb(),f.Nb(26,"h3"),f.nc(27),f.Mb(),f.Nb(28,"h3"),f.nc(29),f.Mb(),f.Mb(),f.Mb(),f.Mb()),2&e){var t=f.Xb();f.yb(4),f.oc(t.sale.estado),f.yb(2),f.oc(f.ac(7,10,t.sale.amount,"$")),f.yb(5),f.pc("Saldo Pendiente: ",f.ac(12,13,t.sale.saldo,"$"),""),f.yb(3),f.pc("Cuotas Pendientes: ",f.Zb(15,16,t.sale.cuotasPendientes),""),f.yb(3),f.pc("Cuotas Pagadas: ",f.Zb(18,18,t.sale.cuotasPagadas),""),f.yb(3),f.pc("Inter\xe9s: ",f.ac(21,20,t.sale.porcentaje,"%"),""),f.yb(3),f.pc("N\xfamero de cuotas: ",t.sale.numeroCuotas,""),f.yb(2),f.pc("Monto de la Cuota: ",t.sale.montoCuota,""),f.yb(2),f.pc("Creado: ",t.sale.createdAt,""),f.yb(2),f.pc("Vencimiento: ",t.sale.vencimiento,"")}}function k(e,n){if(1&e){var t=f.Ob();f.Nb(0,"ion-button",11),f.Vb("click",(function(){f.jc(t);var e=f.Xb();return e.agregarAbono(e.sale.montoCuota)})),f.nc(1,"Abonar"),f.Mb()}}function I(e,n){if(1&e&&(f.Nb(0,"h3"),f.nc(1),f.Mb()),2&e){var t=f.Xb().$implicit;f.yb(1),f.pc("Modificado: ",t.updated,"")}}function A(e,n){if(1&e&&(f.Nb(0,"p"),f.nc(1),f.Mb()),2&e){var t=f.Xb().$implicit;f.yb(1),f.pc(" Nota: ",t.note,"")}}function x(e,n){if(1&e){var t=f.Ob();f.Nb(0,"ion-item-option",8),f.Vb("click",(function(){f.jc(t);var e=f.Xb().index;return f.Xb(2).editarAbono(e)})),f.Jb(1,"ion-icon",16),f.Mb()}}function S(e,n){if(1&e){var t=f.Ob();f.Nb(0,"ion-item-option",17),f.Vb("click",(function(){f.jc(t);var e=f.Xb().index;return f.Xb(2).confirmDelete(e)})),f.Jb(1,"ion-icon",18),f.Mb()}}function w(e,n){if(1&e&&(f.Nb(0,"ion-item-sliding",5),f.Nb(1,"ion-item"),f.Nb(2,"ion-label"),f.Nb(3,"h2"),f.nc(4),f.Mb(),f.Nb(5,"h3"),f.nc(6),f.Mb(),f.mc(7,I,2,1,"h3",4),f.mc(8,A,2,1,"p",4),f.Mb(),f.Mb(),f.Nb(9,"ion-item-options",13),f.mc(10,x,2,0,"ion-item-option",14),f.mc(11,S,2,0,"ion-item-option",15),f.Mb(),f.Mb()),2&e){var t=n.$implicit,o=f.Xb(2);f.yb(4),f.pc("Monto: ",t.monto,""),f.yb(2),f.pc("Creado: ",t.createdAt,""),f.yb(1),f.ec("ngIf",t.updated),f.yb(1),f.ec("ngIf",t.note),f.yb(2),f.ec("ngIf",o.roleAutorization.canEditAbono(o.authSvc.getLoggedUser())),f.yb(1),f.ec("ngIf",o.roleAutorization.canDeleteAbono(o.authSvc.getLoggedUser()))}}function P(e,n){if(1&e&&(f.Lb(0),f.mc(1,w,12,6,"ion-item-sliding",12),f.Kb()),2&e){var t=f.Xb();f.yb(1),f.ec("ngForOf",t.sale.abonos)}}var j,O,R,X=[{path:"",component:(j=function(){function t(n,o,a,r,i,c,s){e(this,t),this.route=n,this.alertController=o,this.alertService=a,this.salesService=r,this.authSvc=i,this.roleAutorization=c,this.modalController=s,this.loading=!1,this.saleId=this.route.snapshot.paramMap.get("id")}var o,a,r;return o=t,(a=[{key:"ngOnInit",value:function(){var e=this;this.loading=!0,this.salesService.getSaleById(this.saleId).subscribe((function(n){e.loading=!1,e.sale=n,e.sale.id=e.saleId}))}},{key:"agregarAbono",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,o=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Realizar Abono!",inputs:[{name:"monto",type:"number",placeholder:"Monto",value:e},{name:"note",type:"textarea",placeholder:"Notas"}],buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Guardar",handler:function(e){e.monto&&(o.sale.abonos.push({monto:parseInt(e.monto),note:e.note,createdAt:u().format("ll"),createdBy:o.authSvc.getLoggedUser().uid}),o.updateSale())}}]});case 2:return t=n.sent,n.next=5,t.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"editSaleDetail",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.modalController.create({component:d.a,componentProps:{sale:e}});case 2:return(t=n.sent).onDidDismiss().then((function(e){})),n.next=6,t.present();case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"updateSale",value:function(){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.sale.updatedAt=u().format("llll"),this.sale.saldo=this.calcularSaldoPendiente(this.sale),this.sale.cuotasPendientes=this.sale.saldo/this.sale.montoCuota,this.sale.cuotasPagadas=this.sale.numeroCuotas-this.sale.cuotasPendientes,0==this.sale.cuotasPendientes&&(this.sale.estado="Pagado"),console.log("this.sale:",this.sale),e.next=8,this.salesService.updateSale(this.sale).then((function(e){console.log("modificado!!!")}));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"calcularSaldoPendiente",value:function(e){var n=e.montoConInteres;return e&&e.abonos&&e.abonos.length>0&&(n=e.montoConInteres-this.calcularAbonos(e.abonos)),n}},{key:"calcularAbonos",value:function(e){return e.reduce((function(e,n){return e+n.monto}),0)}},{key:"deleteAbono",value:function(e){this.sale.abonos.splice(e,1),this.updateSale()}},{key:"confirmDelete",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,o=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Confirmar!",message:"Eliminar <strong>abono</strong>",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:function(e){}},{text:"Ok",handler:function(){o.deleteAbono(e)}}]});case 2:return t=n.sent,n.next=5,t.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"editarAbono",value:function(e){return Object(b.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,o=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Realizar Abono!",inputs:[{name:"monto",type:"number",placeholder:"Monto",value:this.sale.abonos[e].monto},{name:"note",type:"textarea",placeholder:"Notas",value:this.sale.abonos[e].note}],buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:function(){console.log("Confirm Cancel")}},{text:"Guardar",handler:function(n){n.monto&&(o.sale.abonos[e]={monto:parseInt(n.monto),note:n.note,createdAt:o.sale.abonos[e].createdAt,updated:u().format("ll")},o.updateSale())}}]});case 2:return t=n.sent,n.next=5,t.present();case 5:case"end":return n.stop()}}),n,this)})))}}])&&n(o.prototype,a),r&&n(o,r),t}(),j.\u0275fac=function(e){return new(e||j)(f.Ib(l.a),f.Ib(c.b),f.Ib(m.a),f.Ib(p.a),f.Ib(h.a),f.Ib(g.a),f.Ib(c.T))},j.\u0275cmp=f.Cb({type:j,selectors:[["app-sale-detail"]],decls:17,vars:6,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"sale-detail-page"],["type","indeterminate",4,"ngIf"],[4,"ngIf"],["lines","inset"],["fill","outline",3,"click",4,"ngIf"],["slot","end"],["color","primary",3,"click"],["type","indeterminate"],["color","primary"],["fill","outline",3,"click"],["lines","inset",4,"ngFor","ngForOf"],["side","end"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["slot","icon-only","name","pencil"],["color","danger",3,"click"],["slot","icon-only","name","trash"]],template:function(e,n){1&e&&(f.Nb(0,"ion-header"),f.Nb(1,"ion-toolbar"),f.Nb(2,"ion-title"),f.nc(3,"Detalle de Pr\xe9stamo"),f.Mb(),f.Nb(4,"ion-buttons",0),f.Jb(5,"ion-back-button"),f.Mb(),f.mc(6,v,3,0,"ion-buttons",1),f.Mb(),f.Mb(),f.Nb(7,"ion-content",2),f.mc(8,M,1,0,"ion-progress-bar",3),f.mc(9,N,1,0,"app-skeleton",4),f.mc(10,C,30,23,"ion-card",4),f.Nb(11,"ion-list"),f.Nb(12,"ion-list-header",5),f.Nb(13,"ion-label"),f.nc(14,"Abonos"),f.Mb(),f.mc(15,k,2,0,"ion-button",6),f.Mb(),f.mc(16,P,2,1,"ng-container",4),f.Mb(),f.Mb()),2&e&&(f.yb(6),f.ec("ngIf",n.roleAutorization.canEditSale(n.authSvc.getLoggedUser())),f.yb(2),f.ec("ngIf",n.loading),f.yb(1),f.ec("ngIf",n.loading),f.yb(1),f.ec("ngIf",n.sale),f.yb(5),f.ec("ngIf",n.roleAutorization.canCreateAbono(n.authSvc.getLoggedUser())),f.yb(1),f.ec("ngIf",n.sale&&n.sale.abonos.length>0))},directives:[c.s,c.Q,c.P,c.i,c.e,c.f,r.l,c.p,c.B,c.C,c.A,c.h,c.D,y.a,c.j,c.l,c.m,c.g,c.n,c.k,r.k,c.z,c.v,c.y,c.x,c.t],pipes:[r.d,r.f],styles:[""]}),j)}],D=((R=function n(){e(this,n)}).\u0275mod=f.Gb({type:R}),R.\u0275inj=f.Fb({factory:function(e){return new(e||R)},imports:[[l.j.forChild(X)],l.j]}),R),z=((O=function n(){e(this,n)}).\u0275mod=f.Gb({type:O}),O.\u0275inj=f.Fb({factory:function(e){return new(e||O)},imports:[[r.c,i.e,c.R,D,i.l,s.a]]}),O)}}])}();