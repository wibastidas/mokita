(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{HAXa:function(e,t,n){"use strict";n.r(t),n.d(t,"SaleDetailPageModule",(function(){return X}));var o=n("ofXK"),a=n("3Pt+"),s=n("TEn/"),i=n("PCNd"),c=n("tyNb"),l=n("mrSG"),r=n("wd/R"),b=n("ARc2"),d=n("fXoL"),u=n("3LUQ"),h=n("ccOi"),m=n("lGQG"),p=n("6c4d"),f=n("b1s6");function g(e,t){if(1&e){const e=d.Ob();d.Nb(0,"ion-buttons",7),d.Nb(1,"ion-button",8),d.Vb("click",(function(){d.jc(e);const t=d.Xb();return t.editSaleDetail(t.sale)})),d.nc(2," Editar "),d.Mb(),d.Mb()}}function y(e,t){1&e&&d.Jb(0,"ion-progress-bar",9)}function M(e,t){1&e&&d.Jb(0,"app-skeleton")}function N(e,t){if(1&e&&(d.Nb(0,"ion-card"),d.Nb(1,"ion-card-header"),d.Nb(2,"ion-card-subtitle"),d.Nb(3,"ion-badge",10),d.nc(4),d.Mb(),d.Mb(),d.Nb(5,"ion-card-title"),d.nc(6),d.Yb(7,"currency"),d.Mb(),d.Mb(),d.Nb(8,"ion-card-content"),d.Nb(9,"ion-label"),d.Nb(10,"h3"),d.nc(11),d.Yb(12,"currency"),d.Mb(),d.Nb(13,"h3"),d.nc(14),d.Yb(15,"number"),d.Mb(),d.Nb(16,"h3"),d.nc(17),d.Yb(18,"number"),d.Mb(),d.Nb(19,"h3"),d.nc(20),d.Yb(21,"currency"),d.Mb(),d.Nb(22,"h3"),d.nc(23),d.Mb(),d.Nb(24,"h3"),d.nc(25),d.Mb(),d.Nb(26,"h3"),d.nc(27),d.Mb(),d.Nb(28,"h3"),d.nc(29),d.Mb(),d.Mb(),d.Mb(),d.Mb()),2&e){const e=d.Xb();d.yb(4),d.oc(e.sale.estado),d.yb(2),d.oc(d.ac(7,10,e.sale.amount,"$")),d.yb(5),d.pc("Saldo Pendiente: ",d.ac(12,13,e.sale.saldo,"$"),""),d.yb(3),d.pc("Cuotas Pendientes: ",d.Zb(15,16,e.sale.cuotasPendientes),""),d.yb(3),d.pc("Cuotas Pagadas: ",d.Zb(18,18,e.sale.cuotasPagadas),""),d.yb(3),d.pc("Inter\xe9s: ",d.ac(21,20,e.sale.porcentaje,"%"),""),d.yb(3),d.pc("N\xfamero de cuotas: ",e.sale.numeroCuotas,""),d.yb(2),d.pc("Monto de la Cuota: ",e.sale.montoCuota,""),d.yb(2),d.pc("Creado: ",e.sale.createdAt,""),d.yb(2),d.pc("Vencimiento: ",e.sale.vencimiento,"")}}function C(e,t){if(1&e){const e=d.Ob();d.Nb(0,"ion-button",11),d.Vb("click",(function(){d.jc(e);const t=d.Xb();return t.agregarAbono(t.sale.montoCuota)})),d.nc(1,"Abonar"),d.Mb()}}function I(e,t){if(1&e&&(d.Nb(0,"h3"),d.nc(1),d.Mb()),2&e){const e=d.Xb().$implicit;d.yb(1),d.pc("Modificado: ",e.updated,"")}}function A(e,t){if(1&e&&(d.Nb(0,"p"),d.nc(1),d.Mb()),2&e){const e=d.Xb().$implicit;d.yb(1),d.pc(" Nota: ",e.note,"")}}function v(e,t){if(1&e){const e=d.Ob();d.Nb(0,"ion-item-option",8),d.Vb("click",(function(){d.jc(e);const t=d.Xb().index;return d.Xb(2).editarAbono(t)})),d.Jb(1,"ion-icon",16),d.Mb()}}function S(e,t){if(1&e){const e=d.Ob();d.Nb(0,"ion-item-option",17),d.Vb("click",(function(){d.jc(e);const t=d.Xb().index;return d.Xb(2).confirmDelete(t)})),d.Jb(1,"ion-icon",18),d.Mb()}}function k(e,t){if(1&e&&(d.Nb(0,"ion-item-sliding",5),d.Nb(1,"ion-item"),d.Nb(2,"ion-label"),d.Nb(3,"h2"),d.nc(4),d.Mb(),d.Nb(5,"h3"),d.nc(6),d.Mb(),d.mc(7,I,2,1,"h3",4),d.mc(8,A,2,1,"p",4),d.Mb(),d.Mb(),d.Nb(9,"ion-item-options",13),d.mc(10,v,2,0,"ion-item-option",14),d.mc(11,S,2,0,"ion-item-option",15),d.Mb(),d.Mb()),2&e){const e=t.$implicit,n=d.Xb(2);d.yb(4),d.pc("Monto: ",e.monto,""),d.yb(2),d.pc("Creado: ",e.createdAt,""),d.yb(1),d.ec("ngIf",e.updated),d.yb(1),d.ec("ngIf",e.note),d.yb(2),d.ec("ngIf",n.roleAutorization.canEditAbono(n.authSvc.getLoggedUser())),d.yb(1),d.ec("ngIf",n.roleAutorization.canDeleteAbono(n.authSvc.getLoggedUser()))}}function P(e,t){if(1&e&&(d.Lb(0),d.mc(1,k,12,6,"ion-item-sliding",12),d.Kb()),2&e){const e=d.Xb();d.yb(1),d.ec("ngForOf",e.sale.abonos)}}const j=[{path:"",component:(()=>{class e{constructor(e,t,n,o,a,s,i){this.route=e,this.alertController=t,this.alertService=n,this.salesService=o,this.authSvc=a,this.roleAutorization=s,this.modalController=i,this.loading=!1,this.saleId=this.route.snapshot.paramMap.get("id")}ngOnInit(){this.loading=!0,this.salesService.getSaleById(this.saleId).subscribe(e=>{this.loading=!1,this.sale=e,this.sale.id=this.saleId})}agregarAbono(e){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Realizar Abono!",inputs:[{name:"monto",type:"number",placeholder:"Monto",value:e},{name:"note",type:"textarea",placeholder:"Notas"}],buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Guardar",handler:e=>{e.monto&&(this.sale.abonos.push({monto:parseInt(e.monto),note:e.note,createdAt:r().format("ll"),createdBy:this.authSvc.getLoggedUser().uid}),this.updateSale())}}]});yield t.present()}))}editSaleDetail(e){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:b.a,componentProps:{sale:e}});return t.onDidDismiss().then(e=>{}),yield t.present()}))}updateSale(){return Object(l.a)(this,void 0,void 0,(function*(){this.sale.updatedAt=r().format("llll"),this.sale.saldo=this.calcularSaldoPendiente(this.sale),this.sale.cuotasPendientes=this.sale.saldo/this.sale.montoCuota,this.sale.cuotasPagadas=this.sale.numeroCuotas-this.sale.cuotasPendientes,0==this.sale.cuotasPendientes&&(this.sale.estado="Pagado"),console.log("this.sale:",this.sale),yield this.salesService.updateSale(this.sale).then(e=>{console.log("modificado!!!")})}))}calcularSaldoPendiente(e){let t=e.montoConInteres;return e&&e.abonos&&e.abonos.length>0&&(t=e.montoConInteres-this.calcularAbonos(e.abonos)),t}calcularAbonos(e){return e.reduce((e,t)=>e+t.monto,0)}deleteAbono(e){this.sale.abonos.splice(e,1),this.updateSale()}confirmDelete(e){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Confirmar!",message:"Eliminar <strong>abono</strong>",buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:e=>{}},{text:"Ok",handler:()=>{this.deleteAbono(e)}}]});yield t.present()}))}editarAbono(e){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:"Realizar Abono!",inputs:[{name:"monto",type:"number",placeholder:"Monto",value:this.sale.abonos[e].monto},{name:"note",type:"textarea",placeholder:"Notas",value:this.sale.abonos[e].note}],buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Guardar",handler:t=>{t.monto&&(this.sale.abonos[e]={monto:parseInt(t.monto),note:t.note,createdAt:this.sale.abonos[e].createdAt,updated:r().format("ll")},this.updateSale())}}]});yield t.present()}))}}return e.\u0275fac=function(t){return new(t||e)(d.Ib(c.a),d.Ib(s.b),d.Ib(u.a),d.Ib(h.a),d.Ib(m.a),d.Ib(p.a),d.Ib(s.T))},e.\u0275cmp=d.Cb({type:e,selectors:[["app-sale-detail"]],decls:17,vars:6,consts:[["slot","start"],["slot","end",4,"ngIf"],[1,"sale-detail-page"],["type","indeterminate",4,"ngIf"],[4,"ngIf"],["lines","inset"],["fill","outline",3,"click",4,"ngIf"],["slot","end"],["color","primary",3,"click"],["type","indeterminate"],["color","primary"],["fill","outline",3,"click"],["lines","inset",4,"ngFor","ngForOf"],["side","end"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["slot","icon-only","name","pencil"],["color","danger",3,"click"],["slot","icon-only","name","trash"]],template:function(e,t){1&e&&(d.Nb(0,"ion-header"),d.Nb(1,"ion-toolbar"),d.Nb(2,"ion-title"),d.nc(3,"Detalle de Pr\xe9stamo"),d.Mb(),d.Nb(4,"ion-buttons",0),d.Jb(5,"ion-back-button"),d.Mb(),d.mc(6,g,3,0,"ion-buttons",1),d.Mb(),d.Mb(),d.Nb(7,"ion-content",2),d.mc(8,y,1,0,"ion-progress-bar",3),d.mc(9,M,1,0,"app-skeleton",4),d.mc(10,N,30,23,"ion-card",4),d.Nb(11,"ion-list"),d.Nb(12,"ion-list-header",5),d.Nb(13,"ion-label"),d.nc(14,"Abonos"),d.Mb(),d.mc(15,C,2,0,"ion-button",6),d.Mb(),d.mc(16,P,2,1,"ng-container",4),d.Mb(),d.Mb()),2&e&&(d.yb(6),d.ec("ngIf",t.roleAutorization.canEditSale(t.authSvc.getLoggedUser())),d.yb(2),d.ec("ngIf",t.loading),d.yb(1),d.ec("ngIf",t.loading),d.yb(1),d.ec("ngIf",t.sale),d.yb(5),d.ec("ngIf",t.roleAutorization.canCreateAbono(t.authSvc.getLoggedUser())),d.yb(1),d.ec("ngIf",t.sale&&t.sale.abonos.length>0))},directives:[s.s,s.Q,s.P,s.i,s.e,s.f,o.l,s.p,s.B,s.C,s.A,s.h,s.D,f.a,s.j,s.l,s.m,s.g,s.n,s.k,o.k,s.z,s.v,s.y,s.x,s.t],pipes:[o.d,o.f],styles:[""]}),e})()}];let O=(()=>{class e{}return e.\u0275mod=d.Gb({type:e}),e.\u0275inj=d.Fb({factory:function(t){return new(t||e)},imports:[[c.j.forChild(j)],c.j]}),e})(),X=(()=>{class e{}return e.\u0275mod=d.Gb({type:e}),e.\u0275inj=d.Fb({factory:function(t){return new(t||e)},imports:[[o.c,a.e,s.R,O,a.l,i.a]]}),e})()}}]);